---
- name: Reload system daemon
  become: true
  ansible.builtin.systemd_service:
    daemon_reload: true

- name: Reload user daemon
  ansible.builtin.systemd_service:
    daemon_reload: true
    scope: user
  environment:
    XDG_RUNTIME_DIR: "/run/user/{{ ansible_facts.user_uid }}"

- name: Restart container services
  ansible.builtin.systemd_service:
    name: "{{ item.name }}.service"
    state: restarted
    scope: user
  environment:
    XDG_RUNTIME_DIR: "/run/user/{{ ansible_facts.user_uid }}"
  loop: "{{ pods }}"
  loop_control:
    label: "{{ item.name }}"
  when: item.state | default('present') != 'absent'
